generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String              @id @default(cuid())
  email           String              @unique
  password        String
  name            String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  systemLogs      ActivityLog[]
  notifications   Notification[]
  assignedRecords Record[]
  createdRecords  Record[]            @relation("RecordCreator")
  activityLogs    RecordActivityLog[]
  comments        RecordComment[]
  assignedTasks   Task[]              @relation("TaskAssignee")
  createdTasks    Task[]              @relation("TaskCreator")
}

model Property {
  id               String               @id @default(cuid())
  address          String               @unique
  zpid             String?
  streetAddress    String?
  city             String?
  state            String?
  zipcode          String?
  bedrooms         Int?
  bathrooms        Float?
  livingArea       Int?
  yearBuilt        Int?
  homeType         String?
  price            Float?
  zestimate        Float?
  priceHistory     Json?
  zestimateHistory Json?
  rawData          Json?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  motivations      PropertyMotivation[]
  statuses         PropertyStatus[]
  tags             PropertyTag[]
}

model Tag {
  id         String        @id @default(cuid())
  name       String        @unique
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  properties PropertyTag[]
  records    RecordTag[]
}

model Motivation {
  id         String               @id @default(cuid())
  name       String               @unique
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
  properties PropertyMotivation[]
  records    RecordMotivation[]
}

model PropertyTag {
  id         String   @id @default(cuid())
  propertyId String
  tagId      String
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tag        Tag      @relation(fields: [tagId], references: [id])

  @@unique([propertyId, tagId])
}

model PropertyMotivation {
  id           String     @id @default(cuid())
  propertyId   String
  motivationId String
  createdAt    DateTime   @default(now())
  motivation   Motivation @relation(fields: [motivationId], references: [id])
  property     Property   @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, motivationId])
}

model Status {
  id         String           @id @default(cuid())
  name       String           @unique
  color      String
  isDefault  Boolean          @default(false)
  isActive   Boolean          @default(true)
  order      Int              @default(0)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  properties PropertyStatus[]
  records    Record[]
}

model PropertyStatus {
  id         String   @id @default(cuid())
  propertyId String
  statusId   String
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  status     Status   @relation(fields: [statusId], references: [id])

  @@unique([propertyId, statusId])
}

model Record {
  id                 String              @id @default(cuid())
  ownerFirstName     String?
  ownerLastName      String?
  ownerFullName      String
  isCompany          Boolean             @default(false)
  isCompanyOverride  Boolean?
  propertyStreet     String?
  propertyCity       String?
  propertyState      String?
  propertyZip        String?
  mailingStreet      String?
  mailingCity        String?
  mailingState       String?
  mailingZip         String?
  phone              String?
  email              String?
  notes              String?
  description        String?
  temperature        String?
  estimatedValue     Decimal?
  bedrooms           Int?
  bathrooms          Decimal?
  sqft               Int?
  lotSize            Decimal?
  structureType      String?
  heatingType        String?
  airConditioner     String?
  yearBuilt          Int?
  callAttempts       Int                 @default(0)
  directMailAttempts Int                 @default(0)
  smsAttempts        Int                 @default(0)
  rvmAttempts        Int                 @default(0)
  isContact          Boolean             @default(false)
  isComplete         Boolean             @default(false)
  statusId           String?
  assignedToId       String?
  createdById        String?
  skiptraceDate      DateTime?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  customFieldValues  CustomFieldValue[]
  notifications      Notification[]
  assignedTo         User?               @relation(fields: [assignedToId], references: [id])
  createdBy          User?               @relation("RecordCreator", fields: [createdById], references: [id])
  status             Status?             @relation(fields: [statusId], references: [id])
  activityLogs       RecordActivityLog[]
  comments           RecordComment[]
  emails             RecordEmail[]
  recordMotivations  RecordMotivation[]
  phoneNumbers       RecordPhoneNumber[]
  recordTags         RecordTag[]
  tasks              Task[]
}

model RecordTag {
  id        String   @id @default(cuid())
  recordId  String
  tagId     String
  createdAt DateTime @default(now())
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  tag       Tag      @relation(fields: [tagId], references: [id])

  @@unique([recordId, tagId])
}

model RecordMotivation {
  id           String     @id @default(cuid())
  recordId     String
  motivationId String
  createdAt    DateTime   @default(now())
  motivation   Motivation @relation(fields: [motivationId], references: [id])
  record       Record     @relation(fields: [recordId], references: [id], onDelete: Cascade)

  @@unique([recordId, motivationId])
}

model RecordPhoneNumber {
  id        String   @id @default(cuid())
  recordId  String
  number    String
  type      String   @default("MOBILE")
  statuses  String[] @default([])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)

  @@index([recordId])
}

model RecordEmail {
  id        String   @id @default(cuid())
  recordId  String
  email     String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)

  @@index([recordId])
}

model RecordComment {
  id        String   @id @default(cuid())
  recordId  String
  userId    String
  content   String
  createdAt DateTime @default(now())
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@index([recordId])
  @@index([userId])
}

model RecordActivityLog {
  id        String   @id @default(cuid())
  recordId  String
  userId    String?
  action    String
  field     String?
  oldValue  String?
  newValue  String?
  source    String?
  createdAt DateTime @default(now())
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id])

  @@index([recordId])
  @@index([userId])
  @@index([createdAt])
}

model CustomFieldDefinition {
  id          String             @id @default(cuid())
  name        String
  fieldType   String
  displayType String             @default("card")
  options     String?
  isRequired  Boolean            @default(false)
  order       Int                @default(0)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  values      CustomFieldValue[]
}

model CustomFieldValue {
  id        String                @id @default(cuid())
  value     String?
  fieldId   String
  recordId  String
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt
  field     CustomFieldDefinition @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  record    Record                @relation(fields: [recordId], references: [id], onDelete: Cascade)

  @@unique([fieldId, recordId])
  @@index([recordId])
  @@index([fieldId])
}

model ActivityLog {
  id           String   @id @default(cuid())
  type         String
  action       String
  filename     String?
  description  String?
  total        Int      @default(0)
  processed    Int      @default(0)
  status       String   @default("pending")
  metadata     Json?
  errorMessage String?
  userId       String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User?    @relation(fields: [userId], references: [id])

  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([userId])
}

model Task {
  id              String         @id @default(cuid())
  title           String
  description     String?
  dueDate         DateTime?
  dueTime         String?
  notifyAfter     Int?
  notifyAfterUnit String?
  repeatCount     Int?
  startDate       DateTime?
  recurrence      String?
  recurrenceDays  String[]       @default([])
  skipWeekends    Boolean        @default(false)
  status          String         @default("PENDING")
  priority        String         @default("MEDIUM")
  assignmentType  String         @default("MANUAL")
  assignedToId    String?
  recordId        String?
  createdById     String
  templateId      String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  completedAt     DateTime?
  notifications  Notification[]
  assignedTo     User?          @relation("TaskAssignee", fields: [assignedToId], references: [id])
  createdBy      User           @relation("TaskCreator", fields: [createdById], references: [id])
  record         Record?        @relation(fields: [recordId], references: [id])
  template       TaskTemplate?  @relation(fields: [templateId], references: [id])

  @@index([assignedToId])
  @@index([recordId])
  @@index([status])
  @@index([dueDate])
  @@index([createdById])
}

model TaskTemplate {
  id              String   @id @default(cuid())
  name            String
  title           String
  description     String?
  category        String?
  priority        String   @default("MEDIUM")
  dueDaysFromNow  Int?
  dueTime         String?
  recurrence      String?
  recurrenceDays  String[] @default([])
  skipWeekends    Boolean  @default(false)
  assignmentType  String   @default("MANUAL")
  roundRobinUsers String[] @default([])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tasks           Task[]

  @@index([category])
}

model RoundRobinState {
  id           String   @id @default(cuid())
  identifier   String   @unique
  userIds      String[]
  currentIndex Int      @default(0)
  updatedAt    DateTime @updatedAt
}

model Notification {
  id           String    @id @default(cuid())
  userId       String
  type         String
  title        String
  message      String
  taskId       String?
  recordId     String?
  deliveryType String    @default("IMMEDIATE")
  scheduledFor DateTime?
  isRead       Boolean   @default(false)
  readAt       DateTime?
  isDismissed  Boolean   @default(false)
  createdAt    DateTime  @default(now())
  record       Record?   @relation(fields: [recordId], references: [id])
  task         Task?     @relation(fields: [taskId], references: [id])
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([type])
  @@index([createdAt])
}

model FilterFolder {
  id        String           @id @default(cuid())
  name      String
  order     Int              @default(0)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  templates FilterTemplate[]
}

model FilterTemplate {
  id        String        @id @default(cuid())
  name      String
  filters   Json
  folderId  String?
  folder    FilterFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)
  order     Int           @default(0)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([folderId])
}
