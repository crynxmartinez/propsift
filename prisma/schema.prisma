generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(cuid())
  email           String   @unique
  password        String
  name            String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  assignedRecords Record[]
  comments        RecordComment[]
  activityLogs    RecordActivityLog[]
}

model Property {
  id              String   @id @default(cuid())
  address         String   @unique
  zpid            String?
  streetAddress   String?
  city            String?
  state           String?
  zipcode         String?
  bedrooms        Int?
  bathrooms       Float?
  livingArea      Int?
  yearBuilt       Int?
  homeType        String?
  price           Float?
  zestimate       Float?
  priceHistory    Json?
  zestimateHistory Json?
  rawData         Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tags            PropertyTag[]
  motivations     PropertyMotivation[]
  statuses        PropertyStatus[]
}

model Tag {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  properties PropertyTag[]
  records    RecordTag[]
}

model Motivation {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  properties PropertyMotivation[]
  records    RecordMotivation[]
}

model PropertyTag {
  id         String   @id @default(cuid())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId String
  tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Restrict)
  tagId      String
  createdAt  DateTime @default(now())

  @@unique([propertyId, tagId])
}

model PropertyMotivation {
  id           String     @id @default(cuid())
  property     Property   @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId   String
  motivation   Motivation @relation(fields: [motivationId], references: [id], onDelete: Restrict)
  motivationId String
  createdAt    DateTime   @default(now())

  @@unique([propertyId, motivationId])
}

model Status {
  id         String   @id @default(cuid())
  name       String   @unique
  color      String
  isDefault  Boolean  @default(false)
  isActive   Boolean  @default(true)
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  properties PropertyStatus[]
  records    Record[]
}

model PropertyStatus {
  id         String   @id @default(cuid())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId String
  status     Status   @relation(fields: [statusId], references: [id], onDelete: Restrict)
  statusId   String
  createdAt  DateTime @default(now())

  @@unique([propertyId, statusId])
}

model Record {
  id                  String   @id @default(cuid())
  
  // Owner Information
  ownerFirstName      String?
  ownerLastName       String?
  ownerFullName       String
  isCompany           Boolean  @default(false)
  isCompanyOverride   Boolean?
  
  // Property Address
  propertyStreet      String?
  propertyCity        String?
  propertyState       String?
  propertyZip         String?
  
  // Mailing Address
  mailingStreet       String?
  mailingCity         String?
  mailingState        String?
  mailingZip          String?
  
  // Contact Information (legacy single phone/email - kept for backward compatibility)
  phone               String?
  email               String?
  
  // Notes & Description
  notes               String?
  description         String?
  
  // Temperature (COLD, WARM, HOT)
  temperature         String?
  
  // Property Details
  estimatedValue      Decimal?
  bedrooms            Int?
  bathrooms           Decimal?
  sqft                Int?
  lotSize             Decimal?
  structureType       String?
  heatingType         String?
  airConditioner      String?
  yearBuilt           Int?
  
  // Attempt Counters
  callAttempts        Int      @default(0)
  directMailAttempts  Int      @default(0)
  smsAttempts         Int      @default(0)
  rvmAttempts         Int      @default(0)
  
  // Completeness (computed on save)
  isComplete          Boolean  @default(false)
  
  // Status relation
  statusId            String?
  status              Status?  @relation(fields: [statusId], references: [id])
  
  // Assigned To
  assignedToId        String?
  assignedTo          User?    @relation(fields: [assignedToId], references: [id])
  
  // Skiptrace
  skiptraceDate       DateTime?
  
  // Timestamps
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  // Relations
  recordTags          RecordTag[]
  recordMotivations   RecordMotivation[]
  phoneNumbers        RecordPhoneNumber[]
  emails              RecordEmail[]
  comments            RecordComment[]
  activityLogs        RecordActivityLog[]
}

model RecordTag {
  id        String   @id @default(cuid())
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  recordId  String
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Restrict)
  tagId     String
  createdAt DateTime @default(now())

  @@unique([recordId, tagId])
}

model RecordMotivation {
  id           String     @id @default(cuid())
  record       Record     @relation(fields: [recordId], references: [id], onDelete: Cascade)
  recordId     String
  motivation   Motivation @relation(fields: [motivationId], references: [id], onDelete: Restrict)
  motivationId String
  createdAt    DateTime   @default(now())

  @@unique([recordId, motivationId])
}

model RecordPhoneNumber {
  id        String   @id @default(cuid())
  recordId  String
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  number    String
  type      String   @default("MOBILE") // MOBILE, LANDLINE
  statuses  String[] @default([])       // Array of: PRIMARY, CORRECT, WRONG, NO_ANSWER, DNC, DEAD
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([recordId])
}

model RecordEmail {
  id        String   @id @default(cuid())
  recordId  String
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  email     String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([recordId])
}

model RecordComment {
  id        String   @id @default(cuid())
  recordId  String
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  content   String
  createdAt DateTime @default(now())

  @@index([recordId])
  @@index([userId])
}

model RecordActivityLog {
  id        String   @id @default(cuid())
  recordId  String
  record    Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])
  action    String   // created, updated, deleted
  field     String?  // which field changed
  oldValue  String?
  newValue  String?
  source    String?  // Property Details Page, Bulk Actions, API, etc.
  createdAt DateTime @default(now())

  @@index([recordId])
  @@index([userId])
  @@index([createdAt])
}
